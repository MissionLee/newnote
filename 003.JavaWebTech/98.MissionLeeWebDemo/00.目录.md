# 项目构建目录

- [创建空项目](./01.NewProject.md)
  - Maven提供的web模板，然后引入Spring等pom依赖
- [引入MyBatis插件](./02.MyBatis.md)
  - xml配置 datasource（最初在spring中配置的，后面改到SpringMVC中配置）
  - 注解配置SqlSession
- [引入MyBatis-PageHelper插件](./05.PageHelper.md)
  - 版本上遇到一点小问题，新版的可以，旧版的不好用
- [返回值体系设计](./04.返回体系设计.md)  ⭐⭐⭐ （结合后面看-改动很多）
  - 支持 测试/上线版本 0损耗切换
  - ⭐⭐标准返回深度优化
  - 极简的用法
    - [返回值转为JSON标准输出的执行者-AOP-AspectJ](./03.AspectJ.md)
        - 这里还应该再次学习以下
        - 以此配合返回值体系，保证在正常返回与报错的情况下都能良好的工作
- [Spring的Interceptor](./06.Interceptor.md)
  - 用xml配置好了正常使用
  - 🔺注解配置没成功，等看SpringBoot如何自动配置的时候，可以看看如何自动配置的
  - 可以用preHandle 来做权限控制等内容
- [父子容器](./07.父子容器.md)
  - 这是遇到相关问题后百度到的一篇文章
  - 我自己是从里面的 保守派 切换到 激进派
  - 🔺等理解的更加深刻后再自行调整
- Listener
  - 我写了一个DoNothingListener然后配置到配置文件里面，然后打印了以下DO Nothing
  - 这个大概可以用来初始化一些内容，或者做以下容灾恢复工作
  - 可以用来从数据库数据构建Redis中的服务数据

> 以上归档为SpringMVCWebApplicationDemoV0.1，下面因为由结构调整所以从新开一个版本V0.2

- [项目结构与容器调整-1](./08.项目调整.md)
  - 我希望做出既能满足普通web项目，又能满足大数据项目的基础架构
  - DAO：既满足传统数据库，有可以满足hive hbase redis等
  - Service：同上
  - Controller： web层 或者说 SpringMVC层空值更详细
  - SpringMVC 与 Spring ：
    - 全局父框架Spring 管理所有的 DAO层/Service层
    - SpringMVC管理配置内的子层，维护部分 Controller一级下面的RequestMapping
- 插播一个报错问题处理：我在新电脑上直接导入项目，配置好tomcat之类的，然后启动项目报错缺少 org.springframework.jdbc下的一个包，但是项目在原先笔记本上运行时正常的
  - 原因：我最初创建项目的时候没有用maven管理，jar包直接放在 tomcat下面 lib里面了，所以之前的项目就算不引入jar包还是可以正常运行，这算是一个疏漏吧
- 插播一个maven的东西：在配置slf4j的时候，在没有直接log4j的时候，程序还是读取了log4j的配置文件（改配置文件的内容，程序会有相应的变化）
  - Spring的很多模块使用了日志系统，所以在maven引入的时候，好些地方就已经引入
  - pom里面，按住alt 用左键点击 artifactId 或者 groupId 可以看到这个依赖同时引入了什么依赖，druid就引入了 log4j。
- [引入SLF4J](./09.slf4j.md)
  - 在 [复杂项目配置slf4j+log4j2](../04.log/复杂项目使用slf4j.md) 中有配置总结
  - 学习slf4j：
    - 可以获取项目中引入的log处理的实例类并启动代理
    - 还可以假冒其他log实例类，并且在假冒类里面把真正的服务指向自己，然后由自己配置的实例类完成具体工作
- Permission + UserSession + DefaultSecurityInterceptor
  - [Permission](10.权限体系.md) 权限体系 （结合后面看-类名有改动）
    - 主要是基础表设计和里面的业务逻辑
    - 对应还有MVC中的Service 和 Controller
    - 设计了PermissionProcessor，用于管理权限验证
      - 依赖与FunctionService获取基础的功能URL权限数据
      - 依赖UserSessionHandler配合当前请求的HttpServlet中前端传递的key获取用户的角色权限数据 
      - 接口规定了 check 和 refresh两个方法
        - check输入参数检验权限：当前url是否在用户配置的可访问url中
        - 刷新权限基础数据
          - 权限基础数据有变动的时候可以刷新
      - 计划完成三个实现类（基于Redis，JDBC，和内存的）
        - 内存：CacheUrlPermissionProcessor已经完成 2019/1/19
      - 另外还有一个 CheckNothingPermissionProcessor 用于在不想要验证权限的时候跳过这个步骤
      - 与 DefaultSecurityInterceptor 配合
  - UserSession
    - 服务端存储用户登录信息，向前端提供登录标记key值，同时为方便后端拿到key之后快速查询用户信息
    - 设计了一个抽象类UserSessionHandler
      - 规定了 session相关操作的几个方法
      - 设计在基础代码里面完成两个实现
        - Redis实现
        - JDBC实现
      - 与 UserBasicController 的login配合完成session的写入
      - 与DefaultSecurityInterceptor配置实现对前端传递key值的验证
  - DefaultSecurityInterceptor
    - 使用 preHandle方法，在调用 permissionProcessor.check 方法进行权限验证
- [ControllerAdvice](./14.ControllerAdvice.md) 🔺 相关知识还没有详细看
  - 此项目设计后端为纯RESTful模式，返回JSON数据
  - 出现了两个问题
    - 1.做了上面的权限验证，Interceptor中开始的时候代码有bug报错，此时接口返回了Tomcat提供的错误信息页面
    - 2.前端访问不存在的接口，返回了Tomcat提供的404页面
  - 解决：
    - 1.引入 @ControllerAdvice来对报错的情况下，设计json返回
    - 2.404错误比较特殊，只用上面的@ControllerAdvice不能满足要求，🔺 推测原因是404错误的侦测，发生在进入Controller之前
      - 要在web.xml配置 DispatcherServlet的时候加上 throwExceptionInNoHandlerFound = true的配置
- 插播一点经验心得
  - 首先是@Resource的使用：有些内容，例如 UserSessionHandler之类的，最初我也是使用@Resource直接在类体里面注入，后面还是改成在构造方法的时候传入，然后在创建 配置类里面调用构造
    - 解耦很重要
    - 配置类方便管理
    - 用配置类来控制这些，之后再使用配置文件配置的时候也方便改动
  - 关于接口 和 抽象类
    - 最近写代码的时候，总有一些过度设计的嫌疑，想配置一套接口用于各种情况的兼容
      - 1.有些情况下意义不大，未来功能有点贬义
      - 2.使用起来可能变得更加复杂
  - 对于类型参数的使用还不熟练🔺🔺
- [Test&TestResource](11.test.md)
  - 怎么测试
- [从字符集到容器](./13.从字符集到容器.md)
  - 关于idea控制台输出中文乱码的两次处理与心得
- 插播一个低级bug
  - 我尝试把一个Map使用FASTjson转成字符串，然后插入到数据库一个字段里面
  - 当时调用了 JSON.toJSON 方法，这个方法返回的是Object
  - 实际应该调用 JSON.toJSONString 返回String
  - 数据库那边报错 string value 有问题 "\xAB\x19" (举例子，反正是16进制数字)，想当然认为是字符集问题，然后找了一大圈FASTJson如何设置字符集，还有idea/tomcat这些的字符集设置等等 
  - 结果还是好的，学到了一些东西 [从字符集到容器](./13.从字符集到容器.md)
- [Session与Permission的控制架构](./基础与权限架构.md)
  - 实现了 用户-角色-功能 的控制
  - 功能-URLs 的控制
  - Permission体系基于上面两部分内容完成了 用户请求 URL级别的控制
    - 也可以另外实现并且配置权限控制类，达到其他的控制效果
- MySQL的一个坑人点
  - 第一个创建为timestamp 的字段会被默认创建为 随着字段更新而更新 需要手动取消
  - ⭐⭐⭐特别坑人：mysql存在两个不同的timestamp
    - 默认： timestamp - 单位为秒 
      - 例子： 当前时间2019年01月22日14时31分20秒，那么 current_timestamp = 20190122143120
    - UNIX_TIMESTAMP ： 当前毫秒值，单位为秒
  - 我在做基于MySQL的session key过期控制的时候，使用 timestamp，不能达到效果，过期时间3600s，
  - 最后改成 bigint 存储 unix_timestamp() 的方式
- [AopHandlerProcessor]() ⭐⭐⭐⭐⭐ 核心模块 ⭐⭐⭐⭐⭐
  - 对之前[返回值体系设计](./04.返回体系设计.md)的优化实现
  - 在一个 RequestMapping注解下的方法将要执行的时候，拦截这个方法，代理这个方法，代替这个方法
  - 主要实现了对各种正常/异常的情况进行处理，并且保证返回应该返回的内容
- 插播一点东西
  - 我台式机的tomcat在配置文件里面配置了jvm utf-8
  - 但是笔记本没有配置
  - 找到了另外一个配置的地方
    - 项目 EditConfiguration
      - Tomcat Server
        - VM options ： 在这里也可以加上 -Dfile.encoding=UTF-8
- 20190123 一期总结
  - ResponseMonitor 改名为：AopHandlerProcessor
  - DefaultSecurityInterceptor 改名为： DefaultPermissionInterceptor
  - 总结：[WEB部分项目流程](./运行流程.md)
  - JSONResponseProcessor 相比于最开始开发的时候改版数次，做了大量优化调整
---------------------------------
- 计划开发基础架构内容
  - HttpServletRequest请求转换体系   ⭐ 完成
  - 可配置启停的 基于本地/数据库/redis的登录session体系 ⭐ 完成
  - 融入之前的参数处理项目  
  - BigData体系的支撑
  - Excel/csv文件等基础文件的支撑
  - 分布式锁的支撑
  - 图片缩略图的支撑
  - 分布式部署的支撑

- 计划开发功能内容
  - 接口权限空值体系  ⭐完成
  - 模板 用户-角色-功能 体系 与上面拿个融合  ⭐完成



https://bbs.csdn.net/wap/topics/391076893

https://www.cnblogs.com/jiaguozhilian/p/5819032.html